<ion-item *ngIf="visible && isFormControl && !isCaptchaControl && !selectAsRadioBoxes && !selectAsCheckBoxes && !isCustomControl()"
	[color]="theme"
	[formGroup]="formGroup"
	[class.invalid]="invalid"
	[class.select-file]="isFilePickerControl"
	[class.completer-container]="isCompleter"
	[class.select-dropdown]="selectAsDropdown">

	<ion-button *ngIf="icon" fill="clear" slot="start" tabindex="-1">
		<ion-icon [name]="icon" slot="icon-only"></ion-icon>
	</ion-button>

	<ion-button *ngIf="isPasswordControl" fill="clear" color="medium" slot="end" tabindex="-1" (click)="show = !show">
		<ion-icon name="eye" slot="icon-only" [hidden]="type === 'password'"></ion-icon>
		<ion-icon name="eye-off" slot="icon-only" [hidden]="type !== 'password'"></ion-icon>
	</ion-button>

	<ion-button *ngIf="isAllowDelete" fill="clear" color="medium" slot="end" (click)="onDeleted($event)">
		<ion-icon [name]="deleteIcon" slot="icon-only"></ion-icon>
	</ion-button>

	<ion-button *ngIf="isCompleterAllowLookupByModal" fill="clear" color="medium" slot="end" (click)="completerLookupAsync()">
		<ion-icon [name]="completerLookupByModalButtonIcon" slot="icon-only"></ion-icon>
	</ion-button>

	<ion-label *ngIf="label"
		[color]="color.label"
		[position]="position"
		[class]="css.label">{{ label }}</ion-label>

	<ion-input *ngIf="isTextBoxControl" #elementRef
		[formControlName]="formControlName"
		[name]="name"
		[type]="type"
		[placeholder]="placeholder"
		[class]="css.control"
		[required]="required"
		[readonly]="readonly"
		[min]="minValue"
		[max]="maxValue"
		[minlength]="minLength"
		[maxlength]="maxLength"
		[clearOnEdit]="clearOnEdit"
		[attr.style]="style.control"
		(keyup)="onKeyUp($event)"></ion-input>

	<ion-textarea *ngIf="isTextAreaControl" #elementRef
		[formControlName]="formControlName"
		[name]="name"
		[placeholder]="placeholder"
		[class]="css.control"
		[required]="required"
		[readonly]="readonly"
		[minlength]="minLength"
		[maxlength]="maxLength"
		[rows]="rows" 
		[attr.style]="style.control"></ion-textarea>

	<ion-select *ngIf="isSelectControl && !selectAsDropdown" #elementRef
		[name]="name"
		[multiple]="selectMultiple"
		[interface]="selectInterface"
		[interfaceOptions]="selectInterfaceOptions"
		[cancelText]="selectCancelText"
		[okText]="selectOkText"
		[value]="value"
		[disabled]="disabled"
		[placeholder]="placeholder"
		(ionChange)="onChanged($event)">
		<ion-select-option *ngFor="let option of selectOptions; trackBy: trackOption" [value]="option.Value">{{ option.Label }}</ion-select-option>
	</ion-select>

	<ion-datetime *ngIf="isDatePickerControl" #elementRef
		[displayFormat]="datetimeDisplayFormat"
		[pickerFormat]="datetimePickerFormat"
		[dayNames]="datetimeDayNames"
		[dayShortNames]="datetimeDayShortNames"
		[monthNames]="datetimeMonthNames"
		[monthShortNames]="datetimeMonthShortNames"
		[cancelText]="datetimeCancelText"
		[doneText]="datetimeDoneText"
		[min]="minValue"
		[max]="maxValue"
		[value]="datetimeValue"
		[disabled]="disabled"
		[placeholder]="placeholder"
		(ionChange)="onChanged($event)"></ion-datetime>

	<ion-toggle *ngIf="isToggleControl" slot="end" #elementRef
		[name]="name"
		[disabled]="disabled"
		[color]="color.control"
		[checked]="yesnoChecked"
		[title]="description"
		(ionChange)="onChanged($event)"></ion-toggle>

	<ion-checkbox *ngIf="isCheckboxControl" slot="end" #elementRef
		[name]="name"
		[disabled]="disabled"
		[color]="color.control"
		[checked]="yesnoChecked"
		[title]="description"
		(ionChange)="onChanged($event)"></ion-checkbox>

	<ion-range *ngIf="isRangeControl" #elementRef
		[name]="name"
		[color]="color.control"
		[disabled]="disabled"
		[pin]="rangeOptions.AllowPin"
		[snaps]="rangeOptions.AllowSnaps"
		[dualKnobs]="rangeOptions.AllowDualKnobs"
		[ticks]="rangeOptions.AllowTicks"
		[step]="rangeOptions.Step"
		[min]="minValue"
		[max]="maxValue"
		[value]="value"
		[title]="description"
		(ionChange)="onChanged($event)">
		<ion-icon *ngIf="rangeOptions.Icons.Start" [name]="rangeOptions.Icons.Start" size="small" slot="start"></ion-icon>
		<ion-icon *ngIf="rangeOptions.Icons.End" [name]="rangeOptions.Icons.End" size="small" slot="end"></ion-icon>
	</ion-range>

	<select *ngIf="selectAsDropdown" #elementRef
		[formControlName]="formControlName"
		[name]="name"
		[multiple]="selectMultiple"
		[size]="rows" 
		[class]="css.control"
		[attr.style]="style.control"
		(change)="onChanged(this.value)">
		<option *ngFor="let option of selectOptions; trackBy: trackOption" [value]="option.Value" [selected]="selectOptionIsChecked(option.Value)">{{ option.Label }}</option>
	</select>

	<ng2-completer *ngIf="isCompleter" #elementRef
		[inputName]="name"
		[disableInput]="!!disabled"
		[placeholder]="completerPlaceHolder"
		[minSearchLength]="completerMinLength"
		[maxChars]="completerMaxLength"
		[pause]="completerPauseMiliseconds"
		[clearSelected]="completerClearSelected"
		[textSearching]="completerSearchingText"
		[textNoResults]="completerNoResultsText"
		[datasource]="completerDataSource"
		[initialValue]="completerInitialValue"
		(selected)="onChanged($event)"
		(keyup)="onKeyUp($event)"></ng2-completer>
	
	<div *ngIf="isFilePickerControl">
		<div class="file-picker">
			<input type="file" #elementRef
				[accept]="control.Options.FilePickerOptions.Accept"
				[multiple]="control.Options.FilePickerOptions.AllowMultiple"
				[placeholder]="placeholder"
				(change)="onChanged($event)" />
		</div>
		<div *ngIf="isAllowImagePreview" class="image-picker-preview ion-padding">
			<div *ngIf="value.current">
				<img [src]="value.current" />
			</div>
			<div *ngIf="value.new">
				<img [src]="value.new" />
			</div>
		</div>
	</div>
	
	<label *ngIf="description && !isYesNoControl && !isRangeControl"
		[class]="css.description"
		[style]="style.description"
		[innerHTML]="description"></label>

</ion-item>

<ion-list *ngIf="visible && selectAsCheckBoxes" #elementRef>

	<ion-list-header *ngIf="label" [color]="theme">
		<ion-label [class]="css.label">{{ label }}</ion-label>
	</ion-list-header>

	<ion-item *ngFor="let option of selectOptions; trackBy: trackOption" [color]="theme">
		<ion-label>{{ option.Label }}</ion-label>
		<ion-checkbox slot="end" [checked]="selectOptionIsChecked(option.Value)" [value]="option.Value" (ionChange)="onChanged($event)"></ion-checkbox>
	</ion-item>

	<label *ngIf="description"
		[class]="css.description"
		[style]="style.description"
		[innerHTML]="description"></label>

</ion-list>

<ion-radio-group *ngIf="visible && selectAsRadioBoxes" #elementRef
	[name]="name"
	[class.invalid]="invalid"
	[value]="value"
	(ionChange)="onChanged($event)">

	<ion-list-header *ngIf="label" [color]="theme">
		<ion-label [class]="css.label">{{ label }}</ion-label>
	</ion-list-header>

	<ion-item *ngFor="let option of selectOptions; trackBy: trackOption" [color]="theme">
		<ion-label>{{ option.Label }}</ion-label>
		<ion-radio [value]="option.Value"></ion-radio>
	</ion-item>

</ion-radio-group>
	
<div *ngIf="visible && isCaptchaControl">

	<ion-item [color]="theme" [formGroup]="formGroup" [class.invalid]="invalid">
		<ion-label *ngIf="label"
			[color]="color.label"
			[position]="position"
			[class]="css.label">{{ label }}</ion-label>
		<ion-input type="text" #elementRef
			[formControlName]="formControlName"
			[name]="name"
			[placeholder]="placeholder"
			[class]="css.control"
			[required]="required"
			[readonly]="readonly"
			[min]="minValue"
			[max]="maxValue"
			[minlength]="minLength"
			[maxlength]="maxLength"
			[attr.style]="style.control"
			(keyup)="onKeyUp($event)"></ion-input>
		<label *ngIf="description"
			[class]="css.description"
			[style]="style.description"
			[innerHTML]="description"></label>
	</ion-item>

	<ion-item [color]="theme">
		<ion-button fill="clear" (click)="refreshCaptchaImage()">
			<ion-icon icon="refresh" slot="icon-only"></ion-icon>
		</ion-button>
		<img *ngIf="captchaURI" slot="start" [src]="captchaURI"/>
	</ion-item>

</div>

<ion-list *ngIf="visible && (isFormGroup || isFormArray)">
	
	<ion-list-header *ngIf="label" [color]="theme">
		<ion-label [class]="css.label">{{ label }}</ion-label>
	</ion-list-header>
	
	<div *ngIf="isFormGroup">
		<app-form-control *ngFor="let ctrl of subControls; trackBy: trackControl"
			[formGroup]="subFormGroup"
			[control]="ctrl"
			[theme]="theme"></app-form-control>
	</div>
	
	<div *ngIf="isSimpleFormArray">
		<app-form-control *ngFor="let ctrl of subControls; let idx = index; trackBy: trackControl"
			[formGroup]="subFormGroup"
			[formArrayIndex]="idx"
			[control]="ctrl"
			[theme]="theme"></app-form-control>
	</div>
	
	<div *ngIf="isComplexFormArray">
		<div *ngFor="let ctrl of subControls; let idx = index; trackBy: trackControl">
			<ion-list-header *ngIf="getSubLabel(ctrl)" [color]="getSubColor(ctrl)">
				<ion-label [class]="getSubCss(ctrl)">{{ getSubLabel(ctrl) }}</ion-label>
			</ion-list-header>
			<app-form-control *ngFor="let subctrl of getSubControls(ctrl); trackBy: trackControl"
				[formGroup]="getSubFormGroup(idx)"
				[control]="subctrl"
				[theme]="theme"></app-form-control>
		</div>
	</div>

</ion-list>

<control-image-cropper *ngIf="visible && isCustomControl('image-cropper')" #elementRef
	[formGroup]="formGroup"
	[control]="control"
	[settings]="value"
	(change)="onChanged($event)"></control-image-cropper>

<control-object-privileges *ngIf="visible && isCustomControl('object-privileges')" #elementRef
	[formGroup]="formGroup"
	[control]="control"
	[privileges]="value"
	[allowInheritFromParent]="control.Extras['AllowInheritFromParent'] || control.Extras['allowInheritFromParent']"
	(change)="onChanged($event)"></control-object-privileges>

<control-service-privileges *ngIf="visible && isCustomControl('service-privileges')" #elementRef
	[formGroup]="formGroup"
	[control]="control"
	[privileges]="value"
	(change)="onChanged($event)"></control-service-privileges>
